<div class="admin-settings" ng-controller="OrganizationSettingsController">

	<validationmessage results="organizationRepo.ValidationResults"></validationmessage>
	
	<div class="row">
		<div class="col-xs-12 triptych" ng-controller="TriptychController">
			<h1>ORGANIZATIONS AND WORKFLOWS</h1>
			<div class="triptych-wrapper" ng-class="{'collapse': !navigation.expanded}">
				<div class="row triptych-navigation">
					<div class="row">
						<div class="col-xs-12">
							<ul class="breadcrumb">
								<li ng-click="selectOrganization(organizations[0])">
									<a href="#">Vireo Institution</a>
									<span ng-if="getBreadcrumbs().length == 0" class="glyphicon glyphicon-arrow-down"></span>
								</li>
								<li ng-repeat="panel in getBreadcrumbs()" ng-click="selectOrganization(panel.selected.organization)">
									<a href="#">{{panel.selected.organization.name}} ({{panel.selected.organization.category.name}})</a>
									<span ng-if="$last" class="glyphicon glyphicon-arrow-down"></span>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="row" ng-if="organizations.length == 1">
					<div class="col-xs-12">
						<p>Your Institution has no child organizations. Use the 'Create Organization' side module to create your first organization.</p>
					</div>
				</div>
				<div class="row triptych-panels">
				
					<div class="col-xs-12 col-sm-6 col-md-4 panel-wrapper" ng-repeat="panel in navigation.panels | filter:{visible:true}" ng-class="{'opening': panel.opening, 'closing': panel.closing, 'showing': panel.showing, 'back': navigation.backward}">

						<div class="panel panel-default triptych-panel" ng-class="{'active': panel.active, 'previously-active': panel.previouslyActive}" ng-if="organizations.length > 1">
							<div class="panel-heading" ng-click="navigation.expanded = true">
								<span ng-repeat="category in panel.categories" ng-click="panel.filter = category">
									<span class="category-heading" ng-class="{'active': category == panel.filter, 'multiple': panel.categories.length}">{{category}}</span>
									<span ng-if="!$last"> / </span>
								</span>
								<span class="glyphicon glyphicon-arrow-right pull-right" ng-if="panel.selected.childrenOrganizations.length > 0 || panel.previouslyActive">
								</span>
							</div>
							<div class="panel-body">
								<ul class="list-group">
									<li class="list-group-item triptych-panel-entry"
										ng-repeat="organization in panel.organization.childrenOrganizations | filter:{category: {name: panel.filter}} | orderBy:['category.name','name']"
										ng-click="selectOrganization(organization)" 
										ng-class="{'selected': panel.selected.organization.id == organization.id}">
										<ul class="inline-list pull-right">
											<li ng-click="activateManagementPane('edit')">
												<span class="context-icons glyphicon glyphicon-cog pull-right" ng-class="{'active': managementPaneIsActive('edit')}"></span>
											</li>
											<li ng-click="activateManagementPane('workflow')">
												<span class="context-icons glyphicon glyphicon-list-alt pull-right" ng-class="{'active': managementPaneIsActive('workflow')}"></span>
											</li>
											<li ng-click="activateManagementPane('email')">
												<span class="context-icons glyphicon glyphicon-envelope pull-right" ng-class="{'active': managementPaneIsActive('email')}"></span>
											</li>
										</ul>
										<span>
											{{organization.name}}
											<span class="badge" ng-if="organization.childrenOrganizations.length">{{organization.childrenOrganizations.length}}</span>
											<span class="category-label" ng-if="panel.categories.length > 1">{{organization.category.name}}</span>
										</span>
									</li>
								</ul>
							</div>

						</div>

					</div>
				</div>
			</div>
			<div class="row">
				<div class="divider-wrapper col-xs-12" ng-click="navigation.expanded = !navigation.expanded">
					<span class="collapse-btn glyphicon glyphicon-chevron-up" ng-if="navigation.expanded"></span>
					<span ng-if="!navigation.expanded">EXPAND NAVIGATION</span>
					<hr class="divider">
					<span class="collapse-btn glyphicon glyphicon-chevron-down" ng-if="!navigation.expanded"></span>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div id="organizationManagement" class="col-xs-12" ng-controller="OrganizationManagementController">
			<div class="row" ng-if="showOrganizationManagement()">
				<div class="panel-heading">
					<h3 class="panel-title">

						<ul class="inline-list">
							<li ng-click="activateManagementPane('edit')">
								<span	class="management-pane-selector"
										ng-class="{active: managementPaneIsActive('edit')}"
										ng-click="activateManagementPane('edit')" >
										<span class="context-icons glyphicon glyphicon-cog" ng-class="{'active': managementPaneIsActive('edit')}"></span> Manage Organization
								</span>
							</li>
							<li ng-click="activateManagementPane('workflow')">
								<span	class="management-pane-selector"
										ng-click="activateManagementPane('workflow')"
										ng-class="{active: managementPaneIsActive('workflow')}">
										<span class="context-icons glyphicon glyphicon-list-alt" ng-class="{'active': managementPaneIsActive('workflow')}"></span> Manage Workflow
								</span>
							</li>
							<li ng-click="activateManagementPane('email')">
								<span	class="management-pane-selector"
										ng-click="activateManagementPane('email')"
										ng-class="{active: managementPaneIsActive('email')}">
										<span class="context-icons glyphicon glyphicon-envelope" ng-class="{'active': managementPaneIsActive('email')}"></span> Email Workflow Rules
								</span>
							</li>
						</ul>
					</h3>
				</div>
				<div class="col-xs-12 panel-wrap" ng-class="{active: managementPaneIsActive('edit')}">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">Manage {{getSelectedOrganization().name}}</h3>
						</div>

						<div class="panel-body">

							<validationmessage results="getSelectedOrganization().getValidationResults()"></validationmessage>

							<div class="col-md-6">

								<form ng-submit="updateOrganization(getSelectedOrganization())" name="forms.update" novalidate>

									<validatedinput
										label="Name"
										model="getSelectedOrganization()"
										property="name"
										placeholder="Name of the organization"
										form="forms.update"
										validations="getSelectedOrganization().getValidations()"
										results="getSelectedOrganization().getValidationResults()">
									</validatedinput>

									<validatedselect
										label="Category"
										options="organizationCategories"
										optionproperty="name"
										model="getSelectedOrganization()"
										property="category"
										form="forms.update"
										validations="getSelectedOrganization().getValidations()"
										results="getSelectedOrganization().getValidationResults()">
									</validatedselect>

									<div class="pull-right">
										<button
											type="button"
											class="btn btn-danger"
											ng-click="openModal('#organizationConfirmDeleteModal')">Delete Organization</button>
										<button
											type="button"
											class="btn btn-warning"
											ng-click="resetManageOrganization()">Cancel</button>
										<button
											type="submit"
											class="btn btn-primary"
											ng-disabled="forms.update.$invalid">Save</button>
									</div>

								</form>

								<modal modal-id="organizationConfirmDeleteModal"
									modal-view="views/modals/organization/organizationConfirmDeleteModal.html"
									modal-header-class="modal-header-danger"
									modal-backdrop="static">
								</modal>

							</div>
						</div>

					</div>
				</div>
				<div class="col-xs-12 panel-wrap" ng-class="{active: managementPaneIsActive('workflow')}">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">
							Manage {{getSelectedOrganization().name}} Workflow</h3>
						</div>
						<div class="panel-body">

							<button class="btn btn-default modal-add-btn" ng-click="openModal('#addWorkflowStepModal')">
							  Add Workflow Step
							</button>
							<div class="glyphicon glyphicon-info-sign tooltip-span-adjust" tooltip="Dialog in which allows to create workflow step."></div>
							<modal  modal-id="addWorkflowStepModal"
									modal-view="views/modals/organization/workflowStepCreateModal.html"
									modal-header-class="modal-header-primary"
									modal-backdrop="static">
							</modal>
							<accordion single-expand="false" >
								<pane ng-repeat="step in getSelectedOrganization().aggregateWorkflowSteps track by $index" bar-view="views/directives/workflowStep.html" query="{{step.name}}" html="views/directives/workflowStepContent.html">
								{{$index+1}}. {{step.name}}</pane>
							</accordion>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
